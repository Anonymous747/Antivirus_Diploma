﻿// This file was auto-generated by ML.NET Model Builder. 
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers;
using Microsoft.ML;

namespace Antivirus
{
    public partial class EquatableMlModel
    {
        public static ITransformer RetrainPipeline(MLContext context, IDataView trainData)
        {
            var pipeline = BuildPipeline(context);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"Machine", @"Machine"),new InputOutputColumnPair(@"SizeOfOptionalHeader", @"SizeOfOptionalHeader"),new InputOutputColumnPair(@"Characteristics", @"Characteristics"),new InputOutputColumnPair(@"MajorLinkerVersion", @"MajorLinkerVersion"),new InputOutputColumnPair(@"MinorLinkerVersion", @"MinorLinkerVersion"),new InputOutputColumnPair(@"SizeOfCode", @"SizeOfCode"),new InputOutputColumnPair(@"SizeOfInitializedData", @"SizeOfInitializedData"),new InputOutputColumnPair(@"SizeOfUninitializedData", @"SizeOfUninitializedData"),new InputOutputColumnPair(@"AddressOfEntryPoint", @"AddressOfEntryPoint"),new InputOutputColumnPair(@"BaseOfCode", @"BaseOfCode"),new InputOutputColumnPair(@"BaseOfData", @"BaseOfData"),new InputOutputColumnPair(@"ImageBase", @"ImageBase"),new InputOutputColumnPair(@"SectionAlignment", @"SectionAlignment"),new InputOutputColumnPair(@"FileAlignment", @"FileAlignment"),new InputOutputColumnPair(@"MajorOperatingSystemVersion", @"MajorOperatingSystemVersion"),new InputOutputColumnPair(@"MinorOperatingSystemVersion", @"MinorOperatingSystemVersion"),new InputOutputColumnPair(@"MajorImageVersion", @"MajorImageVersion"),new InputOutputColumnPair(@"MinorImageVersion", @"MinorImageVersion"),new InputOutputColumnPair(@"MajorSubsystemVersion", @"MajorSubsystemVersion"),new InputOutputColumnPair(@"MinorSubsystemVersion", @"MinorSubsystemVersion"),new InputOutputColumnPair(@"SizeOfImage", @"SizeOfImage"),new InputOutputColumnPair(@"SizeOfHeaders", @"SizeOfHeaders"),new InputOutputColumnPair(@"CheckSum", @"CheckSum"),new InputOutputColumnPair(@"Subsystem", @"Subsystem"),new InputOutputColumnPair(@"DllCharacteristics", @"DllCharacteristics"),new InputOutputColumnPair(@"SizeOfStackReserve", @"SizeOfStackReserve"),new InputOutputColumnPair(@"SizeOfStackCommit", @"SizeOfStackCommit"),new InputOutputColumnPair(@"SizeOfHeapReserve", @"SizeOfHeapReserve"),new InputOutputColumnPair(@"SizeOfHeapCommit", @"SizeOfHeapCommit"),new InputOutputColumnPair(@"LoaderFlags", @"LoaderFlags"),new InputOutputColumnPair(@"NumberOfRvaAndSizes", @"NumberOfRvaAndSizes"),new InputOutputColumnPair(@"SectionsNb", @"SectionsNb"),new InputOutputColumnPair(@"SectionsMeanEntropy", @"SectionsMeanEntropy"),new InputOutputColumnPair(@"SectionsMinEntropy", @"SectionsMinEntropy"),new InputOutputColumnPair(@"SectionsMaxEntropy", @"SectionsMaxEntropy"),new InputOutputColumnPair(@"SectionsMeanRawsize", @"SectionsMeanRawsize"),new InputOutputColumnPair(@"SectionsMinRawsize", @"SectionsMinRawsize"),new InputOutputColumnPair(@"SectionMaxRawsize", @"SectionMaxRawsize"),new InputOutputColumnPair(@"SectionsMeanVirtualsize", @"SectionsMeanVirtualsize"),new InputOutputColumnPair(@"SectionsMinVirtualsize", @"SectionsMinVirtualsize"),new InputOutputColumnPair(@"SectionMaxVirtualsize", @"SectionMaxVirtualsize"),new InputOutputColumnPair(@"ImportsNbDLL", @"ImportsNbDLL"),new InputOutputColumnPair(@"ImportsNb", @"ImportsNb"),new InputOutputColumnPair(@"ImportsNbOrdinal", @"ImportsNbOrdinal"),new InputOutputColumnPair(@"ExportNb", @"ExportNb"),new InputOutputColumnPair(@"ResourcesNb", @"ResourcesNb"),new InputOutputColumnPair(@"ResourcesMeanEntropy", @"ResourcesMeanEntropy"),new InputOutputColumnPair(@"ResourcesMinEntropy", @"ResourcesMinEntropy"),new InputOutputColumnPair(@"ResourcesMaxEntropy", @"ResourcesMaxEntropy"),new InputOutputColumnPair(@"ResourcesMeanSize", @"ResourcesMeanSize"),new InputOutputColumnPair(@"ResourcesMinSize", @"ResourcesMinSize"),new InputOutputColumnPair(@"ResourcesMaxSize", @"ResourcesMaxSize"),new InputOutputColumnPair(@"LoadConfigurationSize", @"LoadConfigurationSize"),new InputOutputColumnPair(@"VersionInformationSize", @"VersionInformationSize")})      
                                    .Append(mlContext.Transforms.Text.FeaturizeText(inputColumnName:@"Name",outputColumnName:@"Name"))      
                                    .Append(mlContext.Transforms.Text.FeaturizeText(inputColumnName:@"md5",outputColumnName:@"md5"))      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"Machine",@"SizeOfOptionalHeader",@"Characteristics",@"MajorLinkerVersion",@"MinorLinkerVersion",@"SizeOfCode",@"SizeOfInitializedData",@"SizeOfUninitializedData",@"AddressOfEntryPoint",@"BaseOfCode",@"BaseOfData",@"ImageBase",@"SectionAlignment",@"FileAlignment",@"MajorOperatingSystemVersion",@"MinorOperatingSystemVersion",@"MajorImageVersion",@"MinorImageVersion",@"MajorSubsystemVersion",@"MinorSubsystemVersion",@"SizeOfImage",@"SizeOfHeaders",@"CheckSum",@"Subsystem",@"DllCharacteristics",@"SizeOfStackReserve",@"SizeOfStackCommit",@"SizeOfHeapReserve",@"SizeOfHeapCommit",@"LoaderFlags",@"NumberOfRvaAndSizes",@"SectionsNb",@"SectionsMeanEntropy",@"SectionsMinEntropy",@"SectionsMaxEntropy",@"SectionsMeanRawsize",@"SectionsMinRawsize",@"SectionMaxRawsize",@"SectionsMeanVirtualsize",@"SectionsMinVirtualsize",@"SectionMaxVirtualsize",@"ImportsNbDLL",@"ImportsNb",@"ImportsNbOrdinal",@"ExportNb",@"ResourcesNb",@"ResourcesMeanEntropy",@"ResourcesMinEntropy",@"ResourcesMaxEntropy",@"ResourcesMeanSize",@"ResourcesMinSize",@"ResourcesMaxSize",@"LoadConfigurationSize",@"VersionInformationSize",@"Name",@"md5"}))      
                                    .Append(mlContext.Transforms.NormalizeMinMax(@"Features", @"Features"))      
                                    .Append(mlContext.BinaryClassification.Trainers.SdcaLogisticRegression(new SdcaLogisticRegressionBinaryTrainer.Options(){L1Regularization=1F,L2Regularization=0.1F,LabelColumnName=@"legitimate",FeatureColumnName=@"Features"}));

            return pipeline;
        }
    }
}
